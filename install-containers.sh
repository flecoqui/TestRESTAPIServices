#!/bin/bash
# This bash file install Azure Container Registry, Azure Key Vault, Azure Container Instance
# Parameter 1 resourceGroupName 
# Parameter 2 prefixName 
# Parameter 2 cpuCores 
# Parameter 2 memoryInGb
resourceGroupName=$1
prefixName=$2 
cpuCores=$3 
memoryInGb=$4

#############################################################################
log()
{
	echo "$1"
	echo "$1" >> ./install-aci.log
}
#############################################################################
check_os() {
    grep ubuntu /proc/version > /dev/null 2>&1
    isubuntu=${?}
    grep centos /proc/version > /dev/null 2>&1
    iscentos=${?}
    grep redhat /proc/version > /dev/null 2>&1
    isredhat=${?}	
	if [ -f /etc/debian_version ]; then
    isdebian=0
	else
	isdebian=1	
    fi

	if [ $isubuntu -eq 0 ]; then
		OS=Ubuntu
		VER=$(lsb_release -a | grep Release: | sed  's/Release://'| sed -e 's/^[ \t]*//' | cut -d . -f 1)
	elif [ $iscentos -eq 0 ]; then
		OS=Centos
		VER=$(cat /etc/centos-release)
	elif [ $isredhat -eq 0 ]; then
		OS=RedHat
		VER=$(cat /etc/redhat-release)
	elif [ $isdebian -eq 0 ];then
		OS=Debian  # XXX or Ubuntu??
		VER=$(cat /etc/debian_version)
	else
		OS=$(uname -s)
		VER=$(uname -r)
	fi
	
	ARCH=$(uname -m | sed 's/x86_//;s/i[3-6]86/32/')

	log "OS=$OS version $VER Architecture $ARCH"
}
environ=`env`
log "Environment before installation: $environ"

log "Installation script is starting for resource group $(resourceGroupName) with prefixName $(prefixName) cpu $(cpuCores) and memory $(memoryInGbmemoryInGb) at $(date)"
check_os
if [ $iscentos -ne 0 ] && [ $isredhat -ne 0 ] && [ $isubuntu -ne 0 ] && [ $isdebian -ne 0 ];
then
    log "unsupported operating system"
    exit 1 
else
# To be completed
fi
exit 0 

